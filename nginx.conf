events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Include proxy configurations for Next.js apps (these have priority)
    include /etc/nginx/conf.d/*.conf;

    # Default server for static sites (fallback)
    server {
        listen 80 default_server;
        # Captures 'projectname' from 'projectname.localhost'
        server_name ~^(?<project>.+)\.localhost$;

        # This maps to /var/www/html/projectname inside the container
        root /var/www/html/$project;
        index index.html index.htm;

        location / {
            try_files $uri $uri/ /index.html =404;
        }

        # Enable directory listing as fallback (for debugging)
        autoindex on;
    }
}